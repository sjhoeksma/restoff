(function(){"use strict";function e(e){var r=Object.create(t.prototype);return r._isOnline=r.ONLINE_UNKNOWN,r._forcedOffline=!1,r._repo={},r._autoParams={},r._autoHeaders={},r._rootUri=void 0!==e&&e.rootUri?e.rootUri:"",r._dbName=void 0!==e&&e.dbName?e.dbName:"restoff",r._primaryKeyName=void 0!==e&&e.primaryKeyName?e.primaryKeyName:"id",r._dbEngine=low(r._dbName,{storage:low.localStorage}),r}function t(){}var r=this,o=r.restlib||{};o["version-library"]="0.0.19","undefined"!=typeof module&&module.exports?module.exports=o:r.restlib=o,t.prototype=Object.create(Object.prototype,{rootUri:{get:function(){return this._rootUri},set:function(e){this._rootUri=e}},dbName:{get:function(){return this._dbName},set:function(e){this._dbName=e}},primaryKeyName:{get:function(){return this._primaryKeyName},set:function(e){this._primaryKeyName=e}},isForcedOffline:{get:function(){return this._forcedOffline}},repository:{get:function(){return this._repo}},repositorySize:{get:function(){return Object.keys(this.repository).length}},dbEngine:{get:function(){return this._dbEngine}},isOnline:{get:function(){return this._isOnline===this.ONLINE}},isOffline:{get:function(){return this._isOnline===this.ONLINE_NOT}},isOnlineUnknown:{get:function(){return this._isOnline===this.ONLINE_UNKNOWN}},getRequest:{get:function(){var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return this.isForcedOffline?(e.__defineGetter__("readyState2",function(){return e.__proto__.DONE}),e.send=function(){this.onreadystatechange()}):e.__defineGetter__("readyState2",function(){return this.readyState}),e}}}),t.prototype.ONLINE_UNKNOWN=null,t.prototype.ONLINE=!0,t.prototype.ONLINE_NOT=!1,t.prototype.createError=function(e,t){var r=e.statusText,o=e.responseText.replace(/\r?\n|\r/g,""),i=e.status;return 0===i&&(r="Network Error"),{message:r,messageDetail:o,status:i,uri:t}},t.prototype.autoQueryParamSet=function(e,t){return this._autoParams[e]=t,this},t.prototype.autoQueryParamSetGet=function(e){return this._autoParams[e]},t.prototype.autoHeaderParamSet=function(e,t){return this._autoHeaders[e]=t,this},t.prototype.autoHeaderParamSetGet=function(e){return this._autoHeaders[e]},t.prototype.uriGenerate=function(e){var t=e;-1===t.indexOf("http")&&(t=this.rootUri+t);var r=this._autoParams,o=Object.keys(r);if(o.length>0){var i=!0;-1!==t.indexOf("?")?i=!1:t+="?",o.forEach(function(e){t+=(i?"":"&")+e+"="+r[e],i=!1})}return t},t.prototype.forceOffline=function(){this._forcedOffline=!0,this._isOnline=this.ONLINE_NOT},t.prototype.forceOnline=function(){this._forcedOffline=!1,this._isOnline=this.ONLINE_UNKNOWN},t.prototype.repositorySizeBy=function(e){return Object.keys(this.repositoryGet(e)).length},t.prototype.repositoryNameFrom=function(e){var t=this.rootUri;if(""===t){var r=document.createElement("a");r.href=e,t=r.protocol+"//"+r.hostname+(r.port?":"+r.port:"")}var o=e.replace(t,"");"/"===o[0]&&(o=o.slice(1,o.length));var i=o.split("?");i.length>1&&(o=i[0]);var n=o.split("/");return n.length>1&&(o=n[0]),o},t.prototype.primaryKeyFor=function(e,t){var r=t[this.primaryKeyName];return void 0===t[this.primaryKeyName]&&console.log("Warning: resource did not have a primaryKey "+r),r},t.prototype.repositoryAdd=function(e,t){var r=JSON.parse(t);return this.repositoryAddResource(e,r)},t.prototype.repositoryAddResource=function(e,t){var r=this.repositoryNameFrom(e),o=this;return void 0===this._repo[r]&&(this._repo[r]=[]),t instanceof Array?t.forEach(function(e){o._repo[r][o.primaryKeyFor(r,e)]=e,o.dbEngine(r).push(e)}):(this._repo[r][this.primaryKeyFor(r,t)]=t,this.dbEngine(r).push(t)),this._repo[r]},t.prototype.repositoryGet=function(e){return void 0===this._repo[e]&&(this._repo[e]=[]),this._repo[e]},t.prototype.repositoryResourceGet=function(e,t){return void 0===this._repo[e]?(this._repo[e]=[],this._repo[e]):this._repo[e][t]},t.prototype.repositoryDelete=function(e){var t=document.createElement("a");t.href=e;var r=t.pathname.split("/")[1],o=t.pathname.split("/")[2];void 0===this._repo[r]&&(this._repo[r]=[]),void 0!==this._repo[r][o]&&delete this._repo[r][o]},t.prototype.clearCacheBy=function(e){void 0!==this._repo[e]&&(this._repo[e]=[])},t.prototype.clearCacheAll=function(){var e=this;Object.keys(this.repository).forEach(function(t){e._repo[t]=[]})},t.prototype.get=function(e){var t=this,r=new Promise(function(r,o){var i=t.getRequest,n=t.uriGenerate(e);i.open("GET",n,!0);var s=t._autoHeaders;Object.keys(s).forEach(function(e){i.setRequestHeader(e,s[e])}),i.onreadystatechange=function(){if(i.__proto__.HEADERS_RECEIVED===i.readyState2);else if(i.__proto__.DONE===i.readyState2)if(i.__proto__.UNSENT===i.status&&t.isForcedOffline){var e=t.repositoryNameFrom(n);void 0===t.repository[e]&&t.repositoryAddResource(n,[]),r(t.repository[e])}else 200===i.status?(t._isOnline=t.ONLINE,r(t.repositoryAdd(n,i.response))):(t._isOnline=t.ONLINE_NOT,o(t.createError(i,n)))},i.send()});return r},t.prototype.post=function(e,t){var r=this,o=new Promise(function(o,i){var n=r.getRequest,s=r.uriGenerate(e),a=JSON.stringify(t);n.open("POST",s,!0),n.onreadystatechange=function(){n.__proto__.DONE===n.readyState2&&(201===n.status?o(r.repositoryAddResource(s,t)):i(r.createError(n,s)))},n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(a)});return o},t.prototype.put=function(e,t){var r=this,o=new Promise(function(o,i){var n=r.getRequest,s=r.uriGenerate(e),a=JSON.stringify(t);n.open("PUT",s,!0),n.onreadystatechange=function(){n.__proto__.DONE===n.readyState2&&(200===n.status?o(r.repositoryAddResource(s,t)):i(r.createError(n,s)))},n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(a)});return o},t.prototype["delete"]=function(e){var t=this,r=new Promise(function(r,o){var i=t.getRequest;i.open("DELETE",t.uriGenerate(e),!0),i.onreadystatechange=function(){i.__proto__.DONE===i.readyState2&&(200===i.status?(t.repositoryDelete(e),r()):404===i.status?(t.repositoryDelete(e),r()):o(t.createError(i,e)))},i.send()});return r},o.restoff=e}).call(this);