(function(){"use strict";function t(t){var r=Object.create(e.prototype);return r._isOnline=r.ONLINE_UNKNOWN,r._forcedOffline=!1,r._repo={},r._autoParams={},r._autoHeaders={},r._rootUri=void 0!==t&&t.rootUri?t.rootUri:"",r._dbName=void 0!==t&&t.dbName?t.dbName:"restoff.json",r}function e(){}var r=this,o=r.restlib||{};o["version-library"]="0.0.13","undefined"!=typeof module&&module.exports?module.exports=o:r.restlib=o,e.prototype=Object.create(Object.prototype,{rootUri:{get:function(){return this._rootUri},set:function(t){this._rootUri=t}},dbName:{get:function(){return this._dbName},set:function(t){this._dbName=t}},isForcedOffline:{get:function(){return this._forcedOffline}},repository:{get:function(){return this._repo}},isOnline:{get:function(){return this._isOnline},set:function(t){this._isOnline=t}},getRequest:{get:function(){var t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return t.actuallySent=!1,this.isForcedOffline?(t.__defineGetter__("readyState2",function(){return t.__proto__.DONE}),t.send=function(){this.onreadystatechange()}):t.__defineGetter__("readyState2",function(){return this.readyState}),t}}}),e.prototype.ONLINE_UNKNOWN=null,e.prototype.ONLINE=!0,e.prototype.ONLINE_NOT=!1,e.prototype.autoQueryParam=function(t,e){return this._autoParams[t]=e,this},e.prototype.autoQueryParamGet=function(t){return this._autoParams[t]},e.prototype.autoHeaderParam=function(t,e){return this._autoHeaders[t]=e,this},e.prototype.autoHeaderParamGet=function(t){return this._autoHeaders[t]},e.prototype.uriGenerate=function(t){var e=t,r=this._autoParams,o=Object.keys(r);if(o.length>0){var n=!0;-1!==e.indexOf("?")?n=!1:e+="?",o.forEach(function(t){e+=(n?"":"&")+t+"="+r[t],n=!1})}return e},e.prototype.forceOffline=function(){this._forcedOffline=!0,this._isOnline=this.ONLINE_NOT},e.prototype.forceOnline=function(){this._forcedOffline=!1,this._isOnline=this.ONLINE_UNKNOWN},e.prototype.repoNameFrom=function(t){var e=this.rootUri;if(""===e){var r=document.createElement("a");r.href=t,e=r.protocol+"//"+r.hostname+(r.port?":"+r.port:"")}var o=t.replace(e,"");return"/"==o[0]&&(o=o.slice(1,o.length)),o},e.prototype.repoAdd=function(t,e){var r=this.repoNameFrom(t);return this._repo[r]=JSON.parse(e),this._repo[r]},e.prototype.clearCacheBy=function(t){void 0!==this._repo[t]&&(this._repo[t]={})},e.prototype.clearCacheAll=function(){var t=this;Object.keys(this.repository).forEach(function(e){t._repo[e]={}})},e.prototype.get=function(t){var e=this,r=new Promise(function(r,o){var n=e.getRequest;n.open("GET",e.uriGenerate(t),!0);var i=e._autoHeaders;Object.keys(i).forEach(function(t){n.setRequestHeader(t,i[t])}),n.onreadystatechange=function(){if(n.__proto__.HEADERS_RECEIVED===n.readyState2)n.actuallySent=!0;else if(n.__proto__.DONE===n.readyState2)if(n.__proto__.UNSENT===n.status&&e.isForcedOffline){var i=e.repoNameFrom(t);void 0===e.repository[i]&&e.repoAdd(t,"{}"),r(e.repository[i])}else if(200===n.status)e.isOnline=e.ONLINE,r(e.repoAdd(t,n.response));else{var s={message:n.statusText,messageDetail:n.responseText.replace(/\r?\n|\r/g,""),status:n.status};o(s)}},n.send()});return r},o.restoff=t}).call(this);