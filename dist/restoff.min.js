(function(){"use strict";function e(e){var r=Object.create(t.prototype);return r._isOnline=r.ONLINE_UNKNOWN,r._forcedOffline=!1,r._repo={},r._autoParams={},r._autoHeaders={},r._rootUri=void 0!==e&&e.rootUri?e.rootUri:"",r._dbName=void 0!==e&&e.dbName?e.dbName:"restoff.json",r}function t(){}var r=this,o=r.restlib||{};o["version-library"]="0.0.15","undefined"!=typeof module&&module.exports?module.exports=o:r.restlib=o,t.prototype=Object.create(Object.prototype,{rootUri:{get:function(){return this._rootUri},set:function(e){this._rootUri=e}},dbName:{get:function(){return this._dbName},set:function(e){this._dbName=e}},isForcedOffline:{get:function(){return this._forcedOffline}},repository:{get:function(){return this._repo}},isOnline:{get:function(){return this._isOnline},set:function(e){this._isOnline=e}},getRequest:{get:function(){var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return this.isForcedOffline?(e.__defineGetter__("readyState2",function(){return e.__proto__.DONE}),e.send=function(){this.onreadystatechange()}):e.__defineGetter__("readyState2",function(){return this.readyState}),e}}}),t.prototype.ONLINE_UNKNOWN=null,t.prototype.ONLINE=!0,t.prototype.ONLINE_NOT=!1,t.prototype.createError=function(e,t){var r=e.statusText,o=e.responseText.replace(/\r?\n|\r/g,""),n=e.status;return 0===n&&(r="Network Error"),{message:r,messageDetail:o,status:n,uri:t}},t.prototype.autoQueryParam=function(e,t){return this._autoParams[e]=t,this},t.prototype.autoQueryParamGet=function(e){return this._autoParams[e]},t.prototype.autoHeaderParam=function(e,t){return this._autoHeaders[e]=t,this},t.prototype.autoHeaderParamGet=function(e){return this._autoHeaders[e]},t.prototype.uriGenerate=function(e){var t=e;-1===t.indexOf("http")&&(t=this.rootUri+t);var r=this._autoParams,o=Object.keys(r);if(o.length>0){var n=!0;-1!==t.indexOf("?")?n=!1:t+="?",o.forEach(function(e){t+=(n?"":"&")+e+"="+r[e],n=!1})}return t},t.prototype.forceOffline=function(){this._forcedOffline=!0,this._isOnline=this.ONLINE_NOT},t.prototype.forceOnline=function(){this._forcedOffline=!1,this._isOnline=this.ONLINE_UNKNOWN},t.prototype.repoNameFrom=function(e){var t=this.rootUri;if(""===t){var r=document.createElement("a");r.href=e,t=r.protocol+"//"+r.hostname+(r.port?":"+r.port:"")}var o=e.replace(t,"");return"/"==o[0]&&(o=o.slice(1,o.length)),o},t.prototype.repoAdd=function(e,t){var r=JSON.parse(t);return this.repoAddObject(e,r)},t.prototype.repoAddObject=function(e,t){var r=this.repoNameFrom(e);return t instanceof Array?this._repo[r]=t:(void 0===this._repo[r]&&(this._repo[r]=[]),this._repo[r].push(t)),this._repo[r]},t.prototype.clearCacheBy=function(e){void 0!==this._repo[e]&&(this._repo[e]=[])},t.prototype.clearCacheAll=function(){var e=this;Object.keys(this.repository).forEach(function(t){e._repo[t]=[]})},t.prototype.get=function(e){var t=this,r=new Promise(function(r,o){var n=t.getRequest;n.open("GET",t.uriGenerate(e),!0);var i=t._autoHeaders;Object.keys(i).forEach(function(e){n.setRequestHeader(e,i[e])}),n.onreadystatechange=function(){if(n.__proto__.HEADERS_RECEIVED===n.readyState2);else if(n.__proto__.DONE===n.readyState2)if(n.__proto__.UNSENT===n.status&&t.isForcedOffline){var i=t.repoNameFrom(e);void 0===t.repository[i]&&t.repoAddObject(e,[]),r(t.repository[i])}else 200===n.status?(t.isOnline=t.ONLINE,r(t.repoAdd(e,n.response))):o(t.createError(n,e))},n.send()});return r},t.prototype.post=function(e,t){var r=this,o=new Promise(function(o,n){var i=r.getRequest,s=JSON.stringify(t);i.open("POST",r.uriGenerate(e),!0),i.onreadystatechange=function(){if(i.__proto__.DONE===i.readyState2)if(201===i.status){r.repoNameFrom(e);o(r.repoAddObject(e,t))}else n(r.createError(i,e))},i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(s)});return o},t.prototype["delete"]=function(e){var t=this,r=new Promise(function(r,o){var n=t.getRequest;n.open("DELETE",t.uriGenerate(e),!0),n.onreadystatechange=function(){n.__proto__.DONE===n.readyState2&&r("What happened?")},n.send()});return r},o.restoff=e}).call(this);