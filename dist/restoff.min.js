(function(){"use strict";function e(e){var o=Object.create(t.prototype);return o._isOnline=null,o._forcedOffline=!1,o._dbRepo=void 0!==e&&e.dbRepo?e.dbRepo:r(),o._rootUri=void 0!==e&&e.rootUri?e.rootUri:"",o._primaryKeyName=void 0!==e&&e.primaryKeyName?e.primaryKeyName:"id",o}function t(){}function r(e){var t=Object.create(o.prototype);return t._dbName=void 0!==e&&e.dbName?e.dbName:"restoff",t._low=low(t._dbName,{storage:low.localStorage}),t}function o(){}var n=this,i=n.restlib||{};i["version-library"]="0.0.19","undefined"!=typeof module&&module.exports?module.exports=i:n.restlib=i,t.prototype=Object.create(Object.prototype,{dbRepo:{get:function(){return this._dbRepo}},isStatusOnline:{get:function(){return this._isOnline===!0}},isStatusOffline:{get:function(){return this._isOnline===!1}},isStatusUnknown:{get:function(){return null===this._isOnline}},isForcedOffline:{get:function(){return this._forcedOffline}},primaryKeyName:{get:function(){return this._primaryKeyName},set:function(e){this._primaryKeyName=e}},rootUri:{get:function(){return this._rootUri},set:function(e){this._rootUri=e}},getRequest:{get:function(){var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return this.isForcedOffline?(e.__defineGetter__("readyState2",function(){return e.__proto__.DONE}),e.send=function(){this.onreadystatechange()}):e.__defineGetter__("readyState2",function(){return this.readyState}),e}},deleteSomeTime:{get:function(){return this._isOnline===!0}}}),t.prototype.uriGenerate=function(e){var t=e;return-1===t.indexOf("http")&&(t=this.rootUri+t),t},t.prototype.forceOffline=function(e){this._forcedOffline=!0,this._isOnline=null},t.prototype.primaryKeyFor=function(e){var t=e[this.primaryKeyName];return t},t.prototype.repoAdd=function(e,t){var r=JSON.parse(t);return this.repoAddResource(e,r)},t.prototype.repoGet=function(e){var t=this.repoNameFrom(e);return this.dbRepo.read(t)},t.prototype.repoAddResource=function(e,t){var r=this,o=this.repoNameFrom(e);if(t instanceof Array)t.forEach(function(e){var t=r.primaryKeyFor(e);r.dbRepo.write(o,r.primaryKeyName,t,e)});else{console.log("HERE BUT HOW");this.primaryKeyFor(o,resource);r.dbRepo.write(o,r.primaryKeyName,primaryKey,t)}return t},t.prototype.repoNameFrom=function(e){var t=e.replace(this.rootUri,"");return t},t.prototype.get=function(e){var t=this,r=new Promise(function(r,o){var n=t.getRequest,i=t.uriGenerate(e);n.open("GET",i,!0),n.onreadystatechange=function(){n.__proto__.DONE===n.readyState2&&(n.__proto__.UNSENT===n.status&&t.isForcedOffline?(t._isOnline=!1,r(t.repoGet(i))):200===n.status?(t._isOnline=!0,r(t.repoAdd(i,n.response))):(t._isOnline=0!==n.status?!0:null,o(t.createError(n,i))))},n.send()});return r},t.prototype.createError=function(e,t){var r=e.statusText,o=e.responseText.replace(/\r?\n|\r/g,""),n=e.status;return 0===n&&(r="Network Error"),{message:r,messageDetail:o,status:n,uri:t}},i.restoff=e,o.prototype=Object.create(Object.prototype,{dbName:{get:function(){return this._dbName},set:function(e){this._dbName=e}},dbEngine:{get:function(){return this._low}},deleteSomeTime:{get:function(){return this._isOnline===!0}}}),i.lowdbRepo=r,o.prototype.size=function(e){return this._low(e).size()},o.prototype.clear=function(e){delete this._low.object[e],this._low.write()},o.prototype.clearAll=function(){this._low.object={},this._low.write()},o.prototype.find=function(e,t,r){var o={};return o[t]=r,this._low(e).find(o)},o.prototype.read=function(e){return this._low(e).value()},o.prototype.write=function(e,t,r,o){void 0===this.find(e,t,r)?this._low(e).push(o):console.log("TODO")}}).call(this);